"use strict";(self.webpackChunkjua_mvp=self.webpackChunkjua_mvp||[]).push([[10],{2010:(e,t,r)=>{r.r(t),r.d(t,{default:()=>w});var s=r(7051),i=r(5043),a=r(8185),n=r(2110),o=r(6494),d=r(5865),l=r(5721),c=r(681),u=r(7392),v=r(8734),A=r(9336),h=r(9252),m=r(4194),p=r(3159),x=r(3216),j=r(5472),g=r(9838),f=r(7194),q=r(8565),b=r(579);function w(){const[e,t]=(0,i.useState)([]),[r,w]=(0,i.useState)(null),[y,C]=(0,i.useState)(!0),[S,R]=(0,i.useState)(null),_=(0,x.Zp)();(0,i.useEffect)((()=>{(async()=>{try{var e;const r=null===(e=q.j.currentUser)||void 0===e?void 0:e.uid;if(!r)throw new Error("User not logged in");const i=(0,j.P)((0,j.rJ)(q.db,"serviceRequests"),(0,j._M)("customer","==",r)),a=(await(0,j.GG)(i)).docs.map((e=>(0,s.A)({id:e.id},e.data())));t(a)}catch(r){R("Failed to load service requests.")}finally{C(!1)}})()}),[]);return(0,b.jsx)(g.A,{title:"Service Requests",children:(0,b.jsxs)(h.A,{maxWidth:"md",children:[(0,b.jsxs)(d.A,{align:"center",variant:"h4",sx:{mb:5},children:[(0,b.jsx)("img",{alt:"Booking",width:150,style:{margin:"auto"},src:"/static/illustrations/undraw_booking.svg"}),"Service Requests"]}),y&&(0,b.jsx)(b.Fragment,{children:[...Array(3)].map(((e,t)=>(0,b.jsx)(a.A,{variant:"rectangular",height:80,sx:{margin:"16px auto",width:{xs:"90vw",md:"60vw"}}},t)))}),S&&(0,b.jsx)(m.A,{severity:"error",children:S}),!y&&!S&&(0,b.jsx)(n.A,{sx:{width:"100%",maxWidth:"800px",margin:"0 auto"},children:(0,b.jsxs)(o.A,{children:[(0,b.jsx)(d.A,{variant:"h6",gutterBottom:!0,children:"Your Service Requests"}),(0,b.jsxs)(l.A,{disablePadding:!0,children:[e.map((e=>{var t,r;return(0,b.jsxs)("div",{children:[(0,b.jsx)(c.Ay,{button:!0,onClick:()=>{return t=e.id,void _("/dashboard/service_request/".concat(t));var t},alignItems:"flex-start",secondaryAction:(0,b.jsx)(u.A,{edge:"end","aria-label":"edit",onClick:t=>{t.stopPropagation(),(e=>{w(e)})(e)},children:(0,b.jsx)(p.A,{})}),children:(0,b.jsx)(v.A,{primary:e.subject||"Untitled Request",secondary:(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(d.A,{variant:"body2",color:"text.secondary",children:e.description||"No description provided."}),(0,b.jsx)(d.A,{variant:"caption",color:"text.secondary",children:(null===e||void 0===e||null===(t=e.createdAt)||void 0===t||null===(r=t.toDate)||void 0===r?void 0:r.call(t).toLocaleString())||"Unknown time"})]})})}),(0,b.jsx)(A.A,{component:"li"})]},e.id)})),0===e.length&&!y&&(0,b.jsx)(d.A,{variant:"body2",sx:{textAlign:"center",p:2},children:"No service requests yet."})]})]})}),r&&(0,b.jsx)(f.A,{serviceRequest:r,closeDialog:()=>{w(null)},isServiceProvider:!1,serviceProvider:r.serviceProvider?{id:r.serviceProvider}:null})]})})}},2110:(e,t,r)=>{r.d(t,{A:()=>x});var s=r(8168),i=r(8587),a=r(5043),n=r(8387),o=r(8610),d=r(4535),l=r(8206),c=r(3336),u=r(2532),v=r(2372);function A(e){return(0,v.Ay)("MuiCard",e)}(0,u.A)("MuiCard",["root"]);var h=r(579);const m=["className","raised"],p=(0,d.Ay)(c.A,{name:"MuiCard",slot:"Root",overridesResolver:(e,t)=>t.root})((()=>({overflow:"hidden"}))),x=a.forwardRef((function(e,t){const r=(0,l.b)({props:e,name:"MuiCard"}),{className:a,raised:d=!1}=r,c=(0,i.A)(r,m),u=(0,s.A)({},r,{raised:d}),v=(e=>{const{classes:t}=e;return(0,o.A)({root:["root"]},A,t)})(u);return(0,h.jsx)(p,(0,s.A)({className:(0,n.A)(v.root,a),elevation:d?8:void 0,ref:t,ownerState:u},c))}))},3159:(e,t,r)=>{var s=r(4994);t.A=void 0;var i=s(r(39)),a=r(579);t.A=(0,i.default)((0,a.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit")},6494:(e,t,r)=>{r.d(t,{A:()=>p});var s=r(8168),i=r(8587),a=r(5043),n=r(8387),o=r(8610),d=r(4535),l=r(8206),c=r(2532),u=r(2372);function v(e){return(0,u.Ay)("MuiCardContent",e)}(0,c.A)("MuiCardContent",["root"]);var A=r(579);const h=["className","component"],m=(0,d.Ay)("div",{name:"MuiCardContent",slot:"Root",overridesResolver:(e,t)=>t.root})((()=>({padding:16,"&:last-child":{paddingBottom:24}}))),p=a.forwardRef((function(e,t){const r=(0,l.b)({props:e,name:"MuiCardContent"}),{className:a,component:d="div"}=r,c=(0,i.A)(r,h),u=(0,s.A)({},r,{component:d}),p=(e=>{const{classes:t}=e;return(0,o.A)({root:["root"]},v,t)})(u);return(0,A.jsx)(m,(0,s.A)({as:d,className:(0,n.A)(p.root,a),ownerState:u,ref:t},c))}))},7194:(e,t,r)=>{r.d(t,{A:()=>k});var s=r(7051),i=r(5043),a=r(3536),n=r(2893),o=r(6178),d=r.n(o),l=r(4858),c=r(3216),u=r(4194),v=r(8911),A=r(5795),h=r(8977),m=r(1081),p=r(6600),x=r(5316),j=r(8533),g=r(9347),f=r(794),q=r(9870),b=r(1690),w=r(4826),y=r(2812),C=r(5472),S=r(4646),R=r(8565),_=r(579);function k(e){var t;let{closeDialog:r,serviceRequest:o,serviceProvider:k,isServiceProvider:P=!1}=e;(0,c.Zp)();const U=(0,l.mN)({defaultValues:o||{}}),{register:D,setValue:M,handleSubmit:N}=U,[B,E]=(0,i.useState)((0,a.get)(o,"date_and_time")?new Date((0,a.get)(o,"date_and_time")):null),[F,O]=(0,i.useState)(!1),[J,W]=(0,i.useState)(!1),[L,z]=(0,i.useState)(null),[G,Z]=(0,i.useState)("");(0,i.useEffect)((()=>{k&&M("serviceProvider",k.ref||k.id)}),[k,M]);const H="Accepted"===(null===o||void 0===o?void 0:o.status)||"Cancelled"===(null===o||void 0===o?void 0:o.status);return(0,_.jsxs)(_.Fragment,{children:[H&&(0,_.jsxs)(u.A,{severity:"info",sx:{mb:2},children:["This request has been ",(0,_.jsx)("strong",{children:null===o||void 0===o?void 0:o.status}),null!==o&&void 0!==o&&o.reason?" \u2014 ".concat(o.reason):"",(null===o||void 0===o||null===(t=o.statusUpdatedAt)||void 0===t?void 0:t.toDate)&&(0,_.jsxs)(_.Fragment,{children:[" ","on ",(0,_.jsx)("strong",{children:d()(o.statusUpdatedAt.toDate()).format("lll")})]}),(null===o||void 0===o?void 0:o.statusUpdatedBy)&&(0,_.jsxs)(_.Fragment,{children:[" ","by ",(0,_.jsx)("strong",{children:o.statusUpdatedBy===o.customer?"customer":"provider"})]}),"."]}),(0,_.jsx)("form",{onSubmit:N((async e=>{if(!H)try{O(!0),n.Ay.event({value:1,category:"Service Requests",action:o?"Service Request updated":"Service Request created"});const t=R.j.currentUser;if(!t)return void S.A.error("User is not authenticated.","Error");if(!e.serviceProvider)return void S.A.error("Service Provider is required.","Error");if(!B)return void S.A.error("Please select a valid date and time.","Error");const i=B.toDate?B.toDate():B;if(null!==o&&void 0!==o&&o.id){const t=(0,C.H9)(R.db,"serviceRequests",o.id);await(0,C.mZ)(t,(0,s.A)((0,s.A)({},e),{},{date_and_time:i,updatedAt:(0,C.O5)()}))}else{const r=(0,C.rJ)(R.db,"serviceRequests"),a=(await(0,C.gS)(r,(0,s.A)((0,s.A)({},e),{},{date_and_time:i,createdAt:(0,C.O5)(),status:"Pending",customer:t.uid})),(0,C.rJ)(R.db,"users",t.uid,"notifications"));await(0,C.gS)(a,{title:"Service Request Created",message:"Your new service request has been submitted.",type:"service_request",createdAt:(0,C.O5)(),read:!1});const n=(0,C.rJ)(R.db,"users",e.serviceProvider,"notifications");await(0,C.gS)(n,{title:"New Service Request",message:"".concat(t.displayName||"A user"," has sent you a new service request."),type:"service_request",createdAt:(0,C.O5)(),read:!1})}W(!0),null===r||void 0===r||r()}catch(t){S.A.error("Something went wrong while submitting the request.","Error")}finally{O(!1)}})),children:(0,_.jsxs)(v.A,{spacing:3,children:[(0,_.jsx)(A.A,(0,s.A)({fullWidth:!0,required:!0,label:"Subject",disabled:H},D("subject",{required:"Subject is required"}))),(0,_.jsx)(b.$,{dateAdapter:q.A,adapterLocale:"en-za",children:(0,_.jsx)(w.K,{label:"Ideal date and time for service request",required:!0,disabled:H,value:B,onChange:e=>{E(null!==e&&void 0!==e&&e.toDate?e.toDate():e),M("date_and_time",null!==e&&void 0!==e&&e.toDate?e.toDate():e)},renderInput:e=>(0,_.jsx)(A.A,(0,s.A)({},e))})}),(0,_.jsx)(A.A,(0,s.A)({fullWidth:!0,label:"Description (optional)",disabled:H},D("description"))),(0,_.jsx)(y.A,{fullWidth:!0,size:"large",type:"submit",loading:F,variant:"contained",disabled:H,children:null!==o&&void 0!==o&&o.id?"Update Request":"Send Request"}),(null===o||void 0===o?void 0:o.id)&&!H&&(P?(0,_.jsxs)(v.A,{direction:"row",spacing:2,children:[(0,_.jsx)(h.A,{color:"success",variant:"outlined",onClick:()=>z("Accepted"),children:"Approve"}),(0,_.jsx)(h.A,{color:"error",variant:"outlined",onClick:()=>z("Cancelled"),children:"Cancel"})]}):(0,_.jsx)(h.A,{color:"error",variant:"outlined",onClick:()=>z("Cancelled"),children:"Cancel Request"}))]})}),(0,_.jsxs)(m.A,{open:!!L,onClose:()=>z(null),children:[(0,_.jsxs)(p.A,{children:[L," Service Request"]}),(0,_.jsxs)(x.A,{children:[(0,_.jsx)(j.A,{children:"Cancelled"===L?"Please provide a reason for cancelling this request.":"You are about to approve this request."}),"Cancelled"===L&&(0,_.jsx)(A.A,{autoFocus:!0,margin:"dense",label:"Reason",fullWidth:!0,variant:"standard",value:G,onChange:e=>Z(e.target.value)})]}),(0,_.jsxs)(g.A,{children:[(0,_.jsx)(h.A,{onClick:()=>z(null),children:"Close"}),(0,_.jsx)(h.A,{onClick:()=>(async e=>{try{const t=R.j.currentUser,r=(0,C.H9)(R.db,"serviceRequests",o.id);await(0,C.mZ)(r,(0,s.A)((0,s.A)({status:e},G&&{reason:G}),{},{statusUpdatedAt:(0,C.O5)(),statusUpdatedBy:(null===t||void 0===t?void 0:t.uid)||null,updatedAt:(0,C.O5)()}));const i=(0,C.rJ)(R.db,"serviceRequests",o.id,"logs");await(0,C.gS)(i,{action:e,message:G||"Status changed to ".concat(e),performedBy:(null===t||void 0===t?void 0:t.uid)||null,performedAt:(0,C.O5)()});const a="Cancelled"===e?o.serviceProvider:o.customer,n=(0,C.rJ)(R.db,"users",a,"notifications");await(0,C.gS)(n,{title:"Service Request ".concat(e),message:G||"The request was ".concat(e.toLowerCase(),"."),type:"service_request",createdAt:(0,C.O5)(),read:!1}),z(null),Z(""),S.A.success("Request ".concat(e.toLowerCase()," successfully"),"Success")}catch(t){S.A.error("Failed to process the request.","Error")}})(L),variant:"contained",children:"Confirm"})]})]}),(0,_.jsx)(f.A,{open:J,autoHideDuration:4e3,onClose:()=>W(!1),message:"Service request submitted successfully"})]})}},9838:(e,t,r)=>{r.d(t,{A:()=>h});var s=r(7051),i=r(45),a=r(5173),n=r.n(a),o=r(3602),d=r(9490),l=r(5043),c=r(6446),u=r(579);const v=["children","title","showGoBackArrow","meta"],A=(0,l.forwardRef)(((e,t)=>{let{children:r,title:a="",showGoBackArrow:n=!1,meta:l}=e,A=(0,i.A)(e,v);return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)(d.mg,{children:[(0,u.jsx)("title",{children:"".concat(a," | JUA")}),l]}),(0,u.jsxs)(c.A,(0,s.A)((0,s.A)({ref:t},A),{},{children:[n&&(0,u.jsx)(o.A,{onClick:()=>window.history.go(-1),sx:{top:40,left:20,cursor:"pointer",position:"relative"}}),r]}))]})}));A.propTypes={children:n().node.isRequired,title:n().string,meta:n().node};const h=A}}]);
//# sourceMappingURL=10.70586ce9.chunk.js.map