/*! For license information please see 423.2bfe7a45.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkjua_mvp=self.webpackChunkjua_mvp||[]).push([[423],{3423:(e,t,n)=>{n.r(t),n.d(t,{default:()=>H});var r=n(5043),s=n(3216),i=n(9252),a=n(5865),o=n(8977),c=n(1637),u=n(4194),l=n(7150),d=n(1529),h=n(8812);const p="type.googleapis.com/google.protobuf.Int64Value",v="type.googleapis.com/google.protobuf.UInt64Value";function m(e,t){const n={};for(const r in e)e.hasOwnProperty(r)&&(n[r]=t(e[r]));return n}function f(e){if(null==e)return null;if(e instanceof Number&&(e=e.valueOf()),"number"===typeof e&&isFinite(e))return e;if(!0===e||!1===e)return e;if("[object String]"===Object.prototype.toString.call(e))return e;if(e instanceof Date)return e.toISOString();if(Array.isArray(e))return e.map((e=>f(e)));if("function"===typeof e||"object"===typeof e)return m(e,(e=>f(e)));throw new Error("Data cannot be encoded in JSON: "+e)}function g(e){if(null==e)return e;if(e["@type"])switch(e["@type"]){case p:case v:{const t=Number(e.value);if(isNaN(t))throw new Error("Data cannot be decoded from JSON: "+e);return t}default:throw new Error("Data cannot be decoded from JSON: "+e)}return Array.isArray(e)?e.map((e=>g(e))):"function"===typeof e||"object"===typeof e?m(e,(e=>g(e))):e}const A="functions",w={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class y extends d.g{constructor(e,t,n){super("".concat(A,"/").concat(e),t||""),this.details=n,Object.setPrototypeOf(this,y.prototype)}}function j(e,t){let n,r=function(e){if(e>=200&&e<300)return"ok";switch(e){case 0:case 500:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(e),s=r;try{const e=t&&t.error;if(e){const t=e.status;if("string"===typeof t){if(!w[t])return new y("internal","internal");r=w[t],s=t}const i=e.message;"string"===typeof i&&(s=i),n=e.details,void 0!==n&&(n=g(n))}}catch(i){}return"ok"===r?null:new y(r,s,n)}class k{constructor(e,t,n,r){this.app=e,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,(0,l.xZ)(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.auth=t.getImmediate({optional:!0}),this.messaging=n.getImmediate({optional:!0}),this.auth||t.get().then((e=>this.auth=e),(()=>{})),this.messaging||n.get().then((e=>this.messaging=e),(()=>{})),this.appCheck||null===r||void 0===r||r.get().then((e=>this.appCheck=e),(()=>{}))}async getAuthToken(){if(this.auth)try{const e=await this.auth.getToken();return null===e||void 0===e?void 0:e.accessToken}catch(e){return}}async getMessagingToken(){if(this.messaging&&"Notification"in self&&"granted"===Notification.permission)try{return await this.messaging.getToken()}catch(e){return}}async getAppCheckToken(e){if(this.serverAppAppCheckToken)return this.serverAppAppCheckToken;if(this.appCheck){const t=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return t.error?null:t.token}return null}async getContext(e){return{authToken:await this.getAuthToken(),messagingToken:await this.getMessagingToken(),appCheckToken:await this.getAppCheckToken(e)}}}const b="us-central1",x=/^data: (.*?)(?:\n|$)/;class S{constructor(e,t,n,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:b,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:function(){return fetch(...arguments)};this.app=e,this.fetchImpl=i,this.emulatorOrigin=null,this.contextProvider=new k(e,t,n,r),this.cancelAllRequests=new Promise((e=>{this.deleteService=()=>Promise.resolve(e())}));try{const e=new URL(s);this.customDomain=e.origin+("/"===e.pathname?"":e.pathname),this.region=b}catch(a){this.customDomain=null,this.region=s}}_delete(){return this.deleteService()}_url(e){const t=this.app.options.projectId;if(null!==this.emulatorOrigin){const n=this.emulatorOrigin;return"".concat(n,"/").concat(t,"/").concat(this.region,"/").concat(e)}return null!==this.customDomain?"".concat(this.customDomain,"/").concat(e):"https://".concat(this.region,"-").concat(t,".cloudfunctions.net/").concat(e)}}function C(e,t,n){const r=r=>function(e,t,n,r){const s=e._url(t);return R(e,s,n,r)}(e,t,r,n||{});return r.stream=(n,r)=>function(e,t,n,r){const s=e._url(t);return E(e,s,n,r||{})}(e,t,n,r),r}async function q(e,t,n,r){let s;n["Content-Type"]="application/json";try{s=await r(e,{method:"POST",body:JSON.stringify(t),headers:n})}catch(a){return{status:0,json:null}}let i=null;try{i=await s.json()}catch(a){}return{status:s.status,json:i}}async function T(e,t){const n={},r=await e.contextProvider.getContext(t.limitedUseAppCheckTokens);return r.authToken&&(n.Authorization="Bearer "+r.authToken),r.messagingToken&&(n["Firebase-Instance-ID-Token"]=r.messagingToken),null!==r.appCheckToken&&(n["X-Firebase-AppCheck"]=r.appCheckToken),n}async function R(e,t,n,r){const s={data:n=f(n)},i=await T(e,r),a=function(e){let t=null;return{promise:new Promise(((n,r)=>{t=setTimeout((()=>{r(new y("deadline-exceeded","deadline-exceeded"))}),e)})),cancel:()=>{t&&clearTimeout(t)}}}(r.timeout||7e4),o=await Promise.race([q(t,s,i,e.fetchImpl),a.promise,e.cancelAllRequests]);if(a.cancel(),!o)throw new y("cancelled","Firebase Functions instance was deleted.");const c=j(o.status,o.json);if(c)throw c;if(!o.json)throw new y("internal","Response is not valid JSON object.");let u=o.json.data;if("undefined"===typeof u&&(u=o.json.result),"undefined"===typeof u)throw new y("internal","Response is missing data field.");return{data:g(u)}}async function E(e,t,n,r){var s;const i={data:n=f(n)},a=await T(e,r);let o,c,u;a["Content-Type"]="application/json",a.Accept="text/event-stream";try{o=await e.fetchImpl(t,{method:"POST",body:JSON.stringify(i),headers:a,signal:null===r||void 0===r?void 0:r.signal})}catch(h){if(h instanceof Error&&"AbortError"===h.name){const e=new y("cancelled","Request was cancelled.");return{data:Promise.reject(e),stream:{[Symbol.asyncIterator]:()=>({next:()=>Promise.reject(e)})}}}const e=j(0,null);return{data:Promise.reject(e),stream:{[Symbol.asyncIterator]:()=>({next:()=>Promise.reject(e)})}}}const l=new Promise(((e,t)=>{c=e,u=t}));null===(s=null===r||void 0===r?void 0:r.signal)||void 0===s||s.addEventListener("abort",(()=>{const e=new y("cancelled","Request was cancelled.");u(e)}));const d=function(e,t,n,r){const s=(e,r)=>{const s=e.match(x);if(!s)return;const i=s[1];try{const e=JSON.parse(i);if("result"in e)return void t(g(e.result));if("message"in e)return void r.enqueue(g(e.message));if("error"in e){const t=j(0,e);return r.error(t),void n(t)}}catch(a){if(a instanceof y)return r.error(a),void n(a)}},i=new TextDecoder;return new ReadableStream({start(t){let a="";return o();async function o(){if(null===r||void 0===r?void 0:r.aborted){const e=new y("cancelled","Request was cancelled");return t.error(e),n(e),Promise.resolve()}try{const{value:c,done:u}=await e.read();if(u)return a.trim()&&s(a.trim(),t),void t.close();if(null===r||void 0===r?void 0:r.aborted){const r=new y("cancelled","Request was cancelled");return t.error(r),n(r),void await e.cancel()}a+=i.decode(c,{stream:!0});const l=a.split("\n");a=l.pop()||"";for(const e of l)e.trim()&&s(e.trim(),t);return o()}catch(c){const e=c instanceof y?c:j(0,null);t.error(e),n(e)}}},cancel:()=>e.cancel()})}(o.body.getReader(),c,u,null===r||void 0===r?void 0:r.signal);return{stream:{[Symbol.asyncIterator](){const e=d.getReader();return{async next(){const{value:t,done:n}=await e.read();return{value:t,done:n}},return:async()=>(await e.cancel(),{done:!0,value:void 0})}}},data:l}}const P="@firebase/functions",O="0.12.6";var D;(0,l.om)(new h.uA(A,((e,t)=>{let{instanceIdentifier:n}=t;const r=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),i=e.getProvider("messaging-internal"),a=e.getProvider("app-check-internal");return new S(r,s,i,a,n)}),"PUBLIC").setMultipleInstances(!0)),(0,l.KO)(P,O,D),(0,l.KO)(P,O,"esm2017");var I=n(7194),N=n(7051),_=n(5472),U=n(8565);async function L(e){try{var t;const n=null===(t=U.j.currentUser)||void 0===t?void 0:t.uid;if(!n)throw new Error("User not authenticated");const r=(0,_.H9)(U.db,"serviceRequests",e),s=await(0,_.x7)(r);if(!s.exists())throw new Error("Service request not found.");const i=s.data();if(!(n===i.customer||n===i.serviceProvider))throw new Error("Access denied");return{data:(0,N.A)({id:s.id},i),error:null}}catch(n){return{data:null,error:n.message}}}var F=n(4646),J=n(9838),B=n(579);const K=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,l.Sx)(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:b;(0,d.P1)("Functions",!1);const n=(0,l.j6)((0,d.Ku)(e),A).getImmediate({identifier:t}),r=(0,d.yU)("functions");return r&&function(e,t,n){!function(e,t,n){const r=(0,d.zJ)(t);e.emulatorOrigin="http".concat(r?"s":"","://").concat(t,":").concat(n),r&&((0,d.gE)(e.emulatorOrigin),(0,d.P1)("Functions",!0))}((0,d.Ku)(e),t,n)}(n,...r),n}(),M=new window.YocoSDK({publicKey:"pk_test_ed3c54a6gOol69qa7f45"});function H(){var e;const t=(0,s.Zp)(),{serviceRequestId:n}=(0,s.g)(),[l,h]=(0,r.useState)(null),[p,v]=(0,r.useState)(!0),[m,f]=(0,r.useState)(null),[g,A]=(0,r.useState)(!1);(0,r.useEffect)((()=>{(async()=>{const{data:e,error:t}=await L(n);t&&f(t),e&&h(e),v(!1)})()}),[n]);const w=null===(e=U.j.currentUser)||void 0===e?void 0:e.uid,y=w&&w===(null===l||void 0===l?void 0:l.serviceProvider),j=w&&w===(null===l||void 0===l?void 0:l.customer);return(0,B.jsx)(J.A,{title:"Service Request",children:(0,B.jsxs)(i.A,{maxWidth:"xl",children:[(0,B.jsx)(a.A,{variant:"h4",sx:{mb:5},children:"Service Request"}),(0,B.jsx)(o.A,{variant:"outlined",onClick:()=>{t("/dashboard/service_requests",{replace:!0})},sx:{mb:3},children:"Back"}),p&&(0,B.jsx)(c.A,{}),m&&(0,B.jsx)(u.A,{severity:"error",children:m}),!p&&l&&(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(I.A,{serviceRequest:l,isServiceProvider:y}),j&&"Accepted"===l.status&&"paid"!==l.paymentStatus&&(0,B.jsx)(o.A,{variant:"contained",sx:{mt:5,mr:2},disabled:g,onClick:async()=>{const e=2e4;const t=Math.round(2e6);A(!0),M.showPopup({amountInCents:t,currency:"ZAR",name:"Jua Payment",description:"Pay for advisory session on JUA",callback:async t=>{if(t.error)return F.A.error("".concat(t.error.message),"Error"),void A(!1);try{const a=(r=K,s="processPayment",C((0,d.Ku)(r),s,i));await a({tokenId:t.id,amount:e,serviceRequestId:n}),F.A.success("R".concat(e," paid for session"),"Success");const{data:o}=await L(n);h(o)}catch(a){F.A.error("Something went wrong while processing payment","Error")}finally{A(!1)}var r,s,i}})},children:g?"Processing...":"Pay R".concat(l.fee)}),(0,B.jsx)(o.A,{sx:{mt:5},variant:"contained",onClick:()=>{t("/dashboard/advisory_session_meeting/?room=".concat(n),{replace:!0})},children:"Go To Service Request"})]})]})})}},7194:(e,t,n)=>{n.d(t,{A:()=>R});var r=n(7051),s=n(5043),i=n(3536),a=n(2893),o=n(6178),c=n.n(o),u=n(4858),l=n(3216),d=n(4194),h=n(8911),p=n(5795),v=n(8977),m=n(1081),f=n(6600),g=n(5316),A=n(8533),w=n(9347),y=n(794),j=n(9870),k=n(1690),b=n(4826),x=n(2812),S=n(5472),C=n(4646),q=n(8565),T=n(579);function R(e){var t;let{closeDialog:n,serviceRequest:o,serviceProvider:R,isServiceProvider:E=!1}=e;(0,l.Zp)();const P=(0,u.mN)({defaultValues:o||{}}),{register:O,setValue:D,handleSubmit:I}=P,[N,_]=(0,s.useState)((0,i.get)(o,"date_and_time")?new Date((0,i.get)(o,"date_and_time")):null),[U,L]=(0,s.useState)(!1),[F,J]=(0,s.useState)(!1),[B,K]=(0,s.useState)(null),[M,H]=(0,s.useState)("");(0,s.useEffect)((()=>{R&&D("serviceProvider",R.ref||R.id)}),[R,D]);const V="Accepted"===(null===o||void 0===o?void 0:o.status)||"Cancelled"===(null===o||void 0===o?void 0:o.status);return(0,T.jsxs)(T.Fragment,{children:[V&&(0,T.jsxs)(d.A,{severity:"info",sx:{mb:2},children:["This request has been ",(0,T.jsx)("strong",{children:null===o||void 0===o?void 0:o.status}),null!==o&&void 0!==o&&o.reason?" \u2014 ".concat(o.reason):"",(null===o||void 0===o||null===(t=o.statusUpdatedAt)||void 0===t?void 0:t.toDate)&&(0,T.jsxs)(T.Fragment,{children:[" ","on ",(0,T.jsx)("strong",{children:c()(o.statusUpdatedAt.toDate()).format("lll")})]}),(null===o||void 0===o?void 0:o.statusUpdatedBy)&&(0,T.jsxs)(T.Fragment,{children:[" ","by ",(0,T.jsx)("strong",{children:o.statusUpdatedBy===o.customer?"customer":"provider"})]}),"."]}),(0,T.jsx)("form",{onSubmit:I((async e=>{if(!V)try{L(!0),a.Ay.event({value:1,category:"Service Requests",action:o?"Service Request updated":"Service Request created"});const t=q.j.currentUser;if(!t)return void C.A.error("User is not authenticated.","Error");if(!e.serviceProvider)return void C.A.error("Service Provider is required.","Error");if(!N)return void C.A.error("Please select a valid date and time.","Error");const s=N.toDate?N.toDate():N;if(null!==o&&void 0!==o&&o.id){const t=(0,S.H9)(q.db,"serviceRequests",o.id);await(0,S.mZ)(t,(0,r.A)((0,r.A)({},e),{},{date_and_time:s,updatedAt:(0,S.O5)()}))}else{const n=(0,S.rJ)(q.db,"serviceRequests"),i=(await(0,S.gS)(n,(0,r.A)((0,r.A)({},e),{},{date_and_time:s,createdAt:(0,S.O5)(),status:"Pending",customer:t.uid})),(0,S.rJ)(q.db,"users",t.uid,"notifications"));await(0,S.gS)(i,{title:"Service Request Created",message:"Your new service request has been submitted.",type:"service_request",createdAt:(0,S.O5)(),read:!1});const a=(0,S.rJ)(q.db,"users",e.serviceProvider,"notifications");await(0,S.gS)(a,{title:"New Service Request",message:"".concat(t.displayName||"A user"," has sent you a new service request."),type:"service_request",createdAt:(0,S.O5)(),read:!1})}J(!0),null===n||void 0===n||n()}catch(t){C.A.error("Something went wrong while submitting the request.","Error")}finally{L(!1)}})),children:(0,T.jsxs)(h.A,{spacing:3,children:[(0,T.jsx)(p.A,(0,r.A)({fullWidth:!0,required:!0,label:"Subject",disabled:V},O("subject",{required:"Subject is required"}))),(0,T.jsx)(k.$,{dateAdapter:j.A,adapterLocale:"en-za",children:(0,T.jsx)(b.K,{label:"Ideal date and time for service request",required:!0,disabled:V,value:N,onChange:e=>{_(null!==e&&void 0!==e&&e.toDate?e.toDate():e),D("date_and_time",null!==e&&void 0!==e&&e.toDate?e.toDate():e)},renderInput:e=>(0,T.jsx)(p.A,(0,r.A)({},e))})}),(0,T.jsx)(p.A,(0,r.A)({fullWidth:!0,label:"Description (optional)",disabled:V},O("description"))),(0,T.jsx)(x.A,{fullWidth:!0,size:"large",type:"submit",loading:U,variant:"contained",disabled:V,children:null!==o&&void 0!==o&&o.id?"Update Request":"Send Request"}),(null===o||void 0===o?void 0:o.id)&&!V&&(E?(0,T.jsxs)(h.A,{direction:"row",spacing:2,children:[(0,T.jsx)(v.A,{color:"success",variant:"outlined",onClick:()=>K("Accepted"),children:"Approve"}),(0,T.jsx)(v.A,{color:"error",variant:"outlined",onClick:()=>K("Cancelled"),children:"Cancel"})]}):(0,T.jsx)(v.A,{color:"error",variant:"outlined",onClick:()=>K("Cancelled"),children:"Cancel Request"}))]})}),(0,T.jsxs)(m.A,{open:!!B,onClose:()=>K(null),children:[(0,T.jsxs)(f.A,{children:[B," Service Request"]}),(0,T.jsxs)(g.A,{children:[(0,T.jsx)(A.A,{children:"Cancelled"===B?"Please provide a reason for cancelling this request.":"You are about to approve this request."}),"Cancelled"===B&&(0,T.jsx)(p.A,{autoFocus:!0,margin:"dense",label:"Reason",fullWidth:!0,variant:"standard",value:M,onChange:e=>H(e.target.value)})]}),(0,T.jsxs)(w.A,{children:[(0,T.jsx)(v.A,{onClick:()=>K(null),children:"Close"}),(0,T.jsx)(v.A,{onClick:()=>(async e=>{try{const t=q.j.currentUser,n=(0,S.H9)(q.db,"serviceRequests",o.id);await(0,S.mZ)(n,(0,r.A)((0,r.A)({status:e},M&&{reason:M}),{},{statusUpdatedAt:(0,S.O5)(),statusUpdatedBy:(null===t||void 0===t?void 0:t.uid)||null,updatedAt:(0,S.O5)()}));const s=(0,S.rJ)(q.db,"serviceRequests",o.id,"logs");await(0,S.gS)(s,{action:e,message:M||"Status changed to ".concat(e),performedBy:(null===t||void 0===t?void 0:t.uid)||null,performedAt:(0,S.O5)()});const i="Cancelled"===e?o.serviceProvider:o.customer,a=(0,S.rJ)(q.db,"users",i,"notifications");await(0,S.gS)(a,{title:"Service Request ".concat(e),message:M||"The request was ".concat(e.toLowerCase(),"."),type:"service_request",createdAt:(0,S.O5)(),read:!1}),K(null),H(""),C.A.success("Request ".concat(e.toLowerCase()," successfully"),"Success")}catch(t){C.A.error("Failed to process the request.","Error")}})(B),variant:"contained",children:"Confirm"})]})]}),(0,T.jsx)(y.A,{open:F,autoHideDuration:4e3,onClose:()=>J(!1),message:"Service request submitted successfully"})]})}},9838:(e,t,n)=>{n.d(t,{A:()=>v});var r=n(7051),s=n(45),i=n(5173),a=n.n(i),o=n(3602),c=n(9490),u=n(5043),l=n(6446),d=n(579);const h=["children","title","showGoBackArrow","meta"],p=(0,u.forwardRef)(((e,t)=>{let{children:n,title:i="",showGoBackArrow:a=!1,meta:u}=e,p=(0,s.A)(e,h);return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(c.mg,{children:[(0,d.jsx)("title",{children:"".concat(i," | JUA")}),u]}),(0,d.jsxs)(l.A,(0,r.A)((0,r.A)({ref:t},p),{},{children:[a&&(0,d.jsx)(o.A,{onClick:()=>window.history.go(-1),sx:{top:40,left:20,cursor:"pointer",position:"relative"}}),n]}))]})}));p.propTypes={children:a().node.isRequired,title:a().string,meta:a().node};const v=p}}]);
//# sourceMappingURL=423.2bfe7a45.chunk.js.map