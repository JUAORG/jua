"use strict";(self.webpackChunkjua_mvp=self.webpackChunkjua_mvp||[]).push([[78],{4802:(e,t,r)=>{var s=r(4994);t.A=void 0;var i=s(r(39)),a=r(579);t.A=(0,i.default)((0,a.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close")},5078:(e,t,r)=>{r.r(t),r.d(t,{default:()=>D});var s=r(7051),i=r(5043),a=r(3216),n=r(5472),d=r(3536),o=r(9252),l=r(1637),c=r(5865),u=r(8977),v=r(5721),A=r(681),h=r(3851),x=r(1045),j=r(8734),p=r(8911),m=r(9336),b=r(8565),f=r(4646),y=r(9838),g=r(1081),w=r(2314),q=r(5263),S=r(7392),C=r(4802),k=r(7194),_=r(579);function R(e){const[t,r]=i.useState(e),s=()=>{r(!1)};return(0,_.jsx)("div",{children:(0,_.jsxs)(g.A,{fullScreen:!0,open:t,children:[(0,_.jsx)(w.A,{sx:{position:"relative"},children:(0,_.jsxs)(q.A,{children:[(0,_.jsx)(S.A,{edge:"start",color:"inherit",onClick:s,"aria-label":"close",children:(0,_.jsx)(C.A,{})}),(0,_.jsx)(c.A,{sx:{ml:2,flex:1},variant:"h6",component:"div",children:"Create Service Request"}),(0,_.jsx)(u.A,{autoFocus:!0,color:"inherit",onClick:s,children:"Close"})]})}),(0,_.jsx)(k.A,{})]})})}function D(){const e=(0,a.Zp)(),{juaNetworkUserId:t}=(0,a.g)(),[r,g]=(0,i.useState)(!1),[w,q]=(0,i.useState)(null),[S,C]=(0,i.useState)(!0),k=()=>e("/dashboard/jua_network",{replace:!0});return(0,i.useEffect)((()=>{t&&(async()=>{try{const e=(0,n.H9)(b.db,"users",t),r=await(0,n.x7)(e);if(r.exists()){const e=r.data(),i=(await(0,n.GG)((0,n.rJ)(b.db,"users",t,"education"))).docs.map((e=>(0,s.A)({id:e.id},e.data()))),a=(await(0,n.GG)((0,n.rJ)(b.db,"users",t,"experience"))).docs.map((e=>(0,s.A)({id:e.id},e.data())));q((0,s.A)((0,s.A)({},e),{},{education:i,work:a}))}else f.A.error("User not found","Error")}catch(e){f.A.error("Failed to load user profile","Error")}finally{C(!1)}})()}),[t]),S?(0,_.jsx)(y.A,{title:"Jua Network",children:(0,_.jsx)(o.A,{maxWidth:"xl",children:(0,_.jsx)(l.A,{sx:{display:"block",mx:"auto",my:5}})})}):w?(0,_.jsx)(y.A,{title:"Jua Network",children:(0,_.jsxs)(o.A,{maxWidth:"xl",children:[(0,_.jsx)(c.A,{variant:"h4",sx:{mb:5},children:"Jua Network User Profile"}),(0,_.jsx)(u.A,{onClick:k,children:"Back"}),(0,_.jsx)(v.A,{children:(0,_.jsxs)(A.Ay,{alignItems:"flex-start",children:[(0,_.jsx)(h.A,{children:(0,_.jsx)(x.A,{alt:"".concat(w.first_name,"'s profile picture"),src:w.profile_picture})}),(0,_.jsx)(j.A,{primary:"".concat(w.first_name," ").concat(w.last_name),secondary:(0,_.jsxs)(p.A,{spacing:1,children:[w.about&&(0,_.jsxs)(c.A,{variant:"body2",color:"text.primary",children:["About: ",w.about]}),w.industry&&(0,_.jsxs)(c.A,{variant:"body2",children:["Industry: ",w.industry]}),(0,_.jsxs)(c.A,{variant:"body2",children:["Jua member since: ",new Date(w.join_date).toDateString().slice(4)]}),(0,_.jsx)(c.A,{variant:"h6",children:"Education"}),(0,d.map)(w.education,(e=>(0,_.jsxs)("div",{children:[(0,_.jsxs)(c.A,{variant:"body2",children:["Degree: ",e.degree]}),(0,_.jsxs)(c.A,{variant:"body2",children:["Institution: ",e.institution]}),(0,_.jsxs)(c.A,{variant:"body2",children:["Description: ",e.description]}),(0,_.jsxs)(c.A,{variant:"body2",children:["From: ",e.start_date]}),(0,_.jsxs)(c.A,{variant:"body2",children:["To: ",e.end_date]}),(0,_.jsx)(m.A,{})]},e.id))),(0,_.jsx)(c.A,{variant:"h6",children:"Work"}),(0,d.map)(w.work,(e=>(0,_.jsxs)("div",{children:[(0,_.jsxs)(c.A,{variant:"body2",children:["Company: ",e.company]}),(0,_.jsxs)(c.A,{variant:"body2",children:["Title: ",e.title]}),(0,_.jsxs)(c.A,{variant:"body2",children:["Description: ",e.description]}),(0,_.jsxs)(c.A,{variant:"body2",children:["From: ",e.start_date]}),(0,_.jsxs)(c.A,{variant:"body2",children:["To: ",e.end_date]}),(0,_.jsx)(m.A,{})]},e.id)))]})})]})}),r&&(0,_.jsx)(R,{isOpen:r}),(0,_.jsx)(u.A,{variant:"outlined",onClick:()=>g(!0),sx:{float:"right"},children:"Create Service Request"})]})}):(0,_.jsx)(y.A,{title:"Jua Network",children:(0,_.jsxs)(o.A,{maxWidth:"xl",children:[(0,_.jsx)(c.A,{variant:"h6",children:"User not found or invalid ID."}),(0,_.jsx)(u.A,{onClick:k,children:"Back"})]})})}},7194:(e,t,r)=>{r.d(t,{A:()=>R});var s=r(7051),i=r(5043),a=r(3536),n=r(2893),d=r(6178),o=r.n(d),l=r(4858),c=r(3216),u=r(4194),v=r(8911),A=r(5795),h=r(8977),x=r(1081),j=r(6600),p=r(5316),m=r(8533),b=r(9347),f=r(794),y=r(9870),g=r(1690),w=r(4826),q=r(2812),S=r(5472),C=r(4646),k=r(8565),_=r(579);function R(e){var t;let{closeDialog:r,serviceRequest:d,serviceProvider:R,isServiceProvider:D=!1}=e;(0,c.Zp)();const U=(0,l.mN)({defaultValues:d||{}}),{register:J,setValue:P,handleSubmit:E}=U,[F,O]=(0,i.useState)((0,a.get)(d,"date_and_time")?new Date((0,a.get)(d,"date_and_time")):null),[B,N]=(0,i.useState)(!1),[W,I]=(0,i.useState)(!1),[G,T]=(0,i.useState)(null),[H,Z]=(0,i.useState)("");(0,i.useEffect)((()=>{R&&P("serviceProvider",R.ref||R.id)}),[R,P]);const z="Accepted"===(null===d||void 0===d?void 0:d.status)||"Cancelled"===(null===d||void 0===d?void 0:d.status);return(0,_.jsxs)(_.Fragment,{children:[z&&(0,_.jsxs)(u.A,{severity:"info",sx:{mb:2},children:["This request has been ",(0,_.jsx)("strong",{children:null===d||void 0===d?void 0:d.status}),null!==d&&void 0!==d&&d.reason?" \u2014 ".concat(d.reason):"",(null===d||void 0===d||null===(t=d.statusUpdatedAt)||void 0===t?void 0:t.toDate)&&(0,_.jsxs)(_.Fragment,{children:[" ","on ",(0,_.jsx)("strong",{children:o()(d.statusUpdatedAt.toDate()).format("lll")})]}),(null===d||void 0===d?void 0:d.statusUpdatedBy)&&(0,_.jsxs)(_.Fragment,{children:[" ","by ",(0,_.jsx)("strong",{children:d.statusUpdatedBy===d.customer?"customer":"provider"})]}),"."]}),(0,_.jsx)("form",{onSubmit:E((async e=>{if(!z)try{N(!0),n.Ay.event({value:1,category:"Service Requests",action:d?"Service Request updated":"Service Request created"});const t=k.j.currentUser;if(!t)return void C.A.error("User is not authenticated.","Error");if(!e.serviceProvider)return void C.A.error("Service Provider is required.","Error");if(!F)return void C.A.error("Please select a valid date and time.","Error");const i=F.toDate?F.toDate():F;if(null!==d&&void 0!==d&&d.id){const t=(0,S.H9)(k.db,"serviceRequests",d.id);await(0,S.mZ)(t,(0,s.A)((0,s.A)({},e),{},{date_and_time:i,updatedAt:(0,S.O5)()}))}else{const r=(0,S.rJ)(k.db,"serviceRequests"),a=(await(0,S.gS)(r,(0,s.A)((0,s.A)({},e),{},{date_and_time:i,createdAt:(0,S.O5)(),status:"Pending",customer:t.uid})),(0,S.rJ)(k.db,"users",t.uid,"notifications"));await(0,S.gS)(a,{title:"Service Request Created",message:"Your new service request has been submitted.",type:"service_request",createdAt:(0,S.O5)(),read:!1});const n=(0,S.rJ)(k.db,"users",e.serviceProvider,"notifications");await(0,S.gS)(n,{title:"New Service Request",message:"".concat(t.displayName||"A user"," has sent you a new service request."),type:"service_request",createdAt:(0,S.O5)(),read:!1})}I(!0),null===r||void 0===r||r()}catch(t){C.A.error("Something went wrong while submitting the request.","Error")}finally{N(!1)}})),children:(0,_.jsxs)(v.A,{spacing:3,children:[(0,_.jsx)(A.A,(0,s.A)({fullWidth:!0,required:!0,label:"Subject",disabled:z},J("subject",{required:"Subject is required"}))),(0,_.jsx)(g.$,{dateAdapter:y.A,adapterLocale:"en-za",children:(0,_.jsx)(w.K,{label:"Ideal date and time for service request",required:!0,disabled:z,value:F,onChange:e=>{O(null!==e&&void 0!==e&&e.toDate?e.toDate():e),P("date_and_time",null!==e&&void 0!==e&&e.toDate?e.toDate():e)},renderInput:e=>(0,_.jsx)(A.A,(0,s.A)({},e))})}),(0,_.jsx)(A.A,(0,s.A)({fullWidth:!0,label:"Description (optional)",disabled:z},J("description"))),(0,_.jsx)(q.A,{fullWidth:!0,size:"large",type:"submit",loading:B,variant:"contained",disabled:z,children:null!==d&&void 0!==d&&d.id?"Update Request":"Send Request"}),(null===d||void 0===d?void 0:d.id)&&!z&&(D?(0,_.jsxs)(v.A,{direction:"row",spacing:2,children:[(0,_.jsx)(h.A,{color:"success",variant:"outlined",onClick:()=>T("Accepted"),children:"Approve"}),(0,_.jsx)(h.A,{color:"error",variant:"outlined",onClick:()=>T("Cancelled"),children:"Cancel"})]}):(0,_.jsx)(h.A,{color:"error",variant:"outlined",onClick:()=>T("Cancelled"),children:"Cancel Request"}))]})}),(0,_.jsxs)(x.A,{open:!!G,onClose:()=>T(null),children:[(0,_.jsxs)(j.A,{children:[G," Service Request"]}),(0,_.jsxs)(p.A,{children:[(0,_.jsx)(m.A,{children:"Cancelled"===G?"Please provide a reason for cancelling this request.":"You are about to approve this request."}),"Cancelled"===G&&(0,_.jsx)(A.A,{autoFocus:!0,margin:"dense",label:"Reason",fullWidth:!0,variant:"standard",value:H,onChange:e=>Z(e.target.value)})]}),(0,_.jsxs)(b.A,{children:[(0,_.jsx)(h.A,{onClick:()=>T(null),children:"Close"}),(0,_.jsx)(h.A,{onClick:()=>(async e=>{try{const t=k.j.currentUser,r=(0,S.H9)(k.db,"serviceRequests",d.id);await(0,S.mZ)(r,(0,s.A)((0,s.A)({status:e},H&&{reason:H}),{},{statusUpdatedAt:(0,S.O5)(),statusUpdatedBy:(null===t||void 0===t?void 0:t.uid)||null,updatedAt:(0,S.O5)()}));const i=(0,S.rJ)(k.db,"serviceRequests",d.id,"logs");await(0,S.gS)(i,{action:e,message:H||"Status changed to ".concat(e),performedBy:(null===t||void 0===t?void 0:t.uid)||null,performedAt:(0,S.O5)()});const a="Cancelled"===e?d.serviceProvider:d.customer,n=(0,S.rJ)(k.db,"users",a,"notifications");await(0,S.gS)(n,{title:"Service Request ".concat(e),message:H||"The request was ".concat(e.toLowerCase(),"."),type:"service_request",createdAt:(0,S.O5)(),read:!1}),T(null),Z(""),C.A.success("Request ".concat(e.toLowerCase()," successfully"),"Success")}catch(t){C.A.error("Failed to process the request.","Error")}})(G),variant:"contained",children:"Confirm"})]})]}),(0,_.jsx)(f.A,{open:W,autoHideDuration:4e3,onClose:()=>I(!1),message:"Service request submitted successfully"})]})}},9838:(e,t,r)=>{r.d(t,{A:()=>h});var s=r(7051),i=r(45),a=r(5173),n=r.n(a),d=r(3602),o=r(9490),l=r(5043),c=r(6446),u=r(579);const v=["children","title","showGoBackArrow","meta"],A=(0,l.forwardRef)(((e,t)=>{let{children:r,title:a="",showGoBackArrow:n=!1,meta:l}=e,A=(0,i.A)(e,v);return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)(o.mg,{children:[(0,u.jsx)("title",{children:"".concat(a," | JUA")}),l]}),(0,u.jsxs)(c.A,(0,s.A)((0,s.A)({ref:t},A),{},{children:[n&&(0,u.jsx)(d.A,{onClick:()=>window.history.go(-1),sx:{top:40,left:20,cursor:"pointer",position:"relative"}}),r]}))]})}));A.propTypes={children:n().node.isRequired,title:n().string,meta:n().node};const h=A}}]);
//# sourceMappingURL=78.2fcaabae.chunk.js.map